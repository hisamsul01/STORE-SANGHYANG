<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warehouse Management System - Complete with Add User</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <style>
    .hidden { display: none; }
    body { transition: all 0.3s ease; }
    .dark-bg { background-color: #1f2937; color: #f9fafb; }
    .dark-section { background-color: #374151; color: #d1d5db; }
    .sidebar { width: 250px; height: 100vh; position: fixed; left: 0; top: 0; z-index: 10; }
    .main-content { margin-left: 250px; width: calc(100% - 250px); }
    @media (max-width: 768px) {
      .sidebar { width: 100%; height: auto; position: relative; }
      .main-content { margin-left: 0; width: 100%; }
    }
    .active { background-color: #4f46e5; color: white; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">

  <!-- Login Modal -->
  <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
    <div class="bg-white rounded-lg p-6 w-80 shadow-lg">
      <h2 class="text-xl font-bold mb-4 text-center">Login ke WMS</h2>
      <form id="loginForm" class="space-y-4">
        <div>
          <label for="username" class="block mb-1 font-medium">Username</label>
          <input type="text" id="username" class="w-full border border-gray-300 rounded px-3 py-2" required />
        </div>
        <div>
          <label for="password" class="block mb-1 font-medium">Password</label>
          <input type="password" id="password" class="w-full border border-gray-300 rounded px-3 py-2" required />
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">Login</button>
      </form>
      <p id="loginError" class="text-red-500 mt-2 text-center hidden">Username atau password salah.</p>
    </div>
  </div>

  <!-- Sidebar -->
  <aside id="sidebar" class="sidebar bg-white shadow-md p-4 hidden">
    <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
      <i data-lucide="warehouse" class="w-6 h-6"></i> WMS
    </h2>
    <nav class="space-y-2">
      <button onclick="showSection('dashboard')" class="menu-btn flex items-center gap-2 w-full text-left py-2 px-4 rounded hover:bg-gray-200 active">
        <i data-lucide="bar-chart-3" class="w-5 h-5"></i> Dashboard
      </button>
      <button onclick="showSection('warehouse')" class="menu-btn flex items-center gap-2 w-full text-left py-2 px-4 rounded hover:bg-gray-200">
        <i data-lucide="package" class="w-5 h-5"></i> Warehouse
      </button>
      <button onclick="showSection('reports')" class="menu-btn flex items-center gap-2 w-full text-left py-2 px-4 rounded hover:bg-gray-200">
        <i data-lucide="file-text" class="w-5 h-5"></i> Reports
      </button>
      <button onclick="showSection('users')" class="menu-btn flex items-center gap-2 w-full text-left py-2 px-4 rounded hover:bg-gray-200">
        <i data-lucide="users" class="w-5 h-5"></i> Users
      </button>
      <button onclick="showSection('settings')" class="menu-btn flex items-center gap-2 w-full text-left py-2 px-4 rounded hover:bg-gray-200">
        <i data-lucide="settings" class="w-5 h-5"></i> Settings
      </button>
      <button onclick="logout()" class="flex items-center gap-2 w-full text-left py-2 px-4 rounded hover:bg-gray-200 text-red-600 font-semibold">
        <i data-lucide="log-out" class="w-5 h-5"></i> Logout
      </button>
    </nav>
  </aside>

  <!-- Main Content -->
  <div id="mainContent" class="main-content hidden">
    <!-- Header -->
    <header class="bg-white shadow-sm p-4 flex justify-between items-center">
      <h1 id="pageTitle" class="text-2xl font-bold">Dashboard</h1>
      <div class="flex items-center gap-4">
        <button onclick="toggleDarkMode()" class="p-2 rounded hover:bg-gray-200" title="Toggle Dark Mode">
          <i id="modeIcon" data-lucide="moon" class="w-5 h-5"></i>
        </button>
        <div class="flex items-center gap-2">
          <i data-lucide="user" class="w-5 h-5"></i>
          <span id="loggedInUser">Admin (Administrator)</span>
        </div>
      </div>
    </header>

    <!-- Fixed store list and all previous sections -->
    <script>
      const stores = [
        { id: "01", name: "GENERAL STORE (ANYER)" },
        { id: "02", name: "General store (JKT)" },
        { id: "03", name: "MAIN KITCHEN STORAGE" },
        { id: "04", name: "F&B ADMIN" },
        { id: "05", name: "HOUSEKEEPING" },
        { id: "10", name: "ENGINEERING STORE" },
        { id: "11", name: "PROJECT STORE" },
        { id: "12", name: "ADMIN & GENERAL" },
        { id: "13", name: "SALES & MARKETING" },
        { id: "14", name: "SECURITY" },
        { id: "15", name: "FRONT OFFICE" },
        { id: "16", name: "SPA" },
        { id: "17", name: "HRD" },
        { id: "21", name: "D'BISTRO" },
        { id: "22", name: "KOREAN STORE (KANTIN)" },
        { id: "23", name: "DBAR STORE" },
        { id: "24", name: "LIQUOR STORE" },
        { id: "25", name: "SOUVENIR SHOP" },
        { id: "26", name: "SPORT & RECREATION" },
        { id: "27", name: "JAPANESE STORE" },
        { id: "28", name: "DRAGON BEACH CLUB STORE" },
        { id: "29", name: "SUNSET GRILL STORE" },
        { id: "31", name: "BANQUET STORE" },
        { id: "40", name: "LAUNDRY STORE" }
      ];
    </script>

    <!-- Dashboard Section -->
    <section id="dashboard" class="p-6">
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold">Total Stock Items</h3>
          <p id="totalStock" class="text-2xl font-bold text-blue-600">0</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold">Total Outgoing</h3>
          <p id="totalOutgoing" class="text-2xl font-bold text-orange-600">0</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold">Active Stores</h3>
          <p class="text-2xl font-bold text-green-600">25</p>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold">Low Stock Alerts</h3>
          <p id="lowStockAlerts" class="text-2xl font-bold text-red-600">0</p>
        </div>
      </div>
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold mb-4">Recent Stock Changes</h3>
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-100">
                <th class="p-2 text-left">Item</th>
                <th class="p-2 text-left">Qty</th>
                <th class="p-2 text-left">Time</th>
              </tr>
            </thead>
            <tbody id="recentChanges"></tbody>
          </table>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold mb-4">Top Outgoing Items</h3>
          <table class="w-full border-collapse">
            <thead>
              <tr class="bg-gray-100">
                <th class="p-2 text-left">Item</th>
                <th class="p-2 text-left">Total Qty</th>
              </tr>
            </thead>
            <tbody id="topOutgoingItems"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Warehouse Section -->
    <section id="warehouse" class="hidden p-6">
      <h2 class="text-xl font-semibold mb-4">Warehouse Management</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="plus-circle" class="w-5 h-5 text-blue-500"></i> Barang Masuk
          </h3>
          <form id="formBarangMasuk" class="space-y-4">
            <div>
              <label class="block text-sm font-medium">Nama Barang:</label>
              <input type="text" id="namaBarangMasuk" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>
            <div>
              <label class="block text-sm font-medium">Jumlah:</label>
              <input type="number" id="qtyBarangMasuk" class="w-full border border-gray-300 rounded px-3 py-2" min="1" required />
            </div>
            <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">Tambah</button>
          </form>
          <div id="msgBarangMasuk" class="text-green-500 mt-2"></div>
        </div>
        <div class="bg-white p-4 rounded-lg shadow-md">
          <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
            <i data-lucide="minus-circle" class="w-5 h-5 text-red-500"></i> Barang Keluar
          </h3>
          <form id="formBarangKeluar" class="space-y-4">
            <div>
              <label class="block text-sm font-medium">Nama Barang:</label>
              <input type="text" id="namaBarangKeluar" class="w-full border border-gray-300 rounded px-3 py-2" required />
            </div>
            <div>
              <label class="block text-sm font-medium">Jumlah:</label>
              <input type="number" id="qtyBarangKeluar" class="w-full border border-gray-300 rounded px-3 py-2" min="1" required />
            </div>
            <button type="submit" class="bg-red-500 hover:bg-red-600 text-white py-2 px-4 rounded">Keluar</button>
          </form>
          <div id="msgBarangKeluar" class="text-green-500 mt-2"></div>
        </div>
      </div>
      <div class="bg-white p-4 rounded-lg shadow-md mt-6">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i data-lucide="package" class="w-5 h-5 text-purple-500"></i> Current Stock
        </h3>
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2 text-left">Item</th>
              <th class="p-2 text-left">Quantity</th>
            </tr>
          </thead>
          <tbody id="stockTable"></tbody>
        </table>
      </div>
    </section>

    <!-- Reports Section -->
    <section id="reports" class="hidden p-6">
      <h2 class="text-xl font-semibold mb-4">Reports</h2>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
          <i data-lucide="truck" class="w-5 h-5 text-orange-500"></i> Outgoing Reports
        </h3>
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2 text-left">Item</th>
              <th class="p-2 text-left">Qty</th>
              <th class="p-2 text-left">Store</th>
              <th class="p-2 text-left">Date</th>
            </tr>
          </thead>
          <tbody id="outgoingReports"></tbody>
        </table>
      </div>
    </section>

    <!-- Users Section -->
    <section id="users" class="hidden p-6">
      <h2 class="text-xl font-semibold mb-4 flex justify-between items-center">
        User Management
        <button onclick="toggleAddUserForm()" class="bg-green-600 hover:bg-green-700 text-white py-1 px-3 rounded text-sm">Tambah User</button>
      </h2>
      <div id="addUserForm" class="bg-white p-4 rounded-lg shadow-md mb-6 hidden">
        <h3 class="text-lg font-semibold mb-4">Tambah User Baru</h3>
        <form id="formAddUser" class="space-y-4">
          <div>
            <label for="newUsername" class="block mb-1 font-medium">Username</label>
            <input type="text" id="newUsername" class="w-full border border-gray-300 rounded px-3 py-2" required />
          </div>
          <div>
            <label for="newPassword" class="block mb-1 font-medium">Password</label>
            <input type="password" id="newPassword" class="w-full border border-gray-300 rounded px-3 py-2" required />
          </div>
          <div>
            <label for="newRole" class="block mb-1 font-medium">Role</label>
            <select id="newRole" class="w-full border border-gray-300 rounded px-3 py-2" required>
              <option value="Staff">Staff</option>
              <option value="Administrator">Administrator</option>
            </select>
          </div>
          <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">Simpan User</button>
          <p id="addUserMsg" class="mt-2 text-green-600 hidden"></p>
        </form>
      </div>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <h3 class="text-lg font-semibold mb-4">Daftar User</h3>
        <table class="w-full border-collapse">
          <thead>
            <tr class="bg-gray-100">
              <th class="p-2 text-left">Username</th>
              <th class="p-2 text-left">Role</th>
              <th class="p-2 text-left">Last Login</th>
            </tr>
          </thead>
          <tbody id="userTableBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Settings Section -->
    <section id="settings" class="hidden p-6">
      <h2 class="text-xl font-semibold mb-4">Settings</h2>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-sm font-medium mb-2">Theme</label>
            <select id="themeSelect" class="w-full border border-gray-300 rounded px-3 py-2" onchange="changeTheme()">
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium mb-2">Font</label>
            <select id="fontSelect" class="w-full border border-gray-300 rounded px-3 py-2" onchange="changeFont()">
              <option value="arial">Arial</option>
              <option value="times">Times New Roman</option>
              <option value="courier">Courier New</option>
            </select>
          </div>
        </div>
        <button onclick="saveSettings()" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded">Save Settings</button>
      </div>
    </section>
  </div>

  <script>
    // Fixed store list as per user request
    const defaultUsers = [
      { username: 'admin', password: 'admin123', role: 'Administrator', lastLogin: null },
      { username: 'staff', password: 'staff123', role: 'Staff', lastLogin: null }
    ];

    // LocalStorage keys
    const STOCK_KEY = 'wms_stock';
    const OUTGOING_KEY = 'wms_outgoing';
    const SETTINGS_KEY = 'wms_settings';
    const CHANGES_KEY = 'wms_changes';
    const USERS_KEY = 'wms_users';
    const SESSION_KEY = 'wms_session';

    // Initialize localStorage with default users if not present
    if (!localStorage.getItem(USERS_KEY)) {
      localStorage.setItem(USERS_KEY, JSON.stringify(defaultUsers));
    }

    // Utility functions
    function getData(key) {
      return JSON.parse(localStorage.getItem(key) || (key === STOCK_KEY || key === CHANGES_KEY ? '{}' : '[]'));
    }
    function setData(key, data) {
      localStorage.setItem(key, JSON.stringify(data));
    }

    // Session management
    function getSession() {
      return JSON.parse(localStorage.getItem(SESSION_KEY));
    }
    function setSession(user) {
      localStorage.setItem(SESSION_KEY, JSON.stringify(user));
    }
    function clearSession() {
      localStorage.removeItem(SESSION_KEY);
    }

    // Main data variables
    let stock = getData(STOCK_KEY);
    let outgoing = getData(OUTGOING_KEY);
    let settings = getData(SETTINGS_KEY);
    let changes = getData(CHANGES_KEY);

    // Apply settings
    function applySettings() {
      if (!settings.theme) settings.theme = 'light';
      if (!settings.font) settings.font = 'arial';
      document.body.classList.toggle('dark-bg', settings.theme === 'dark');
      document.querySelectorAll('section').forEach(s => s.classList.toggle('dark-section', settings.theme === 'dark'));
      document.getElementById('modeIcon').setAttribute('data-lucide', settings.theme === 'dark' ? 'sun' : 'moon');
      document.body.style.fontFamily = settings.font === 'times' ? 'Times New Roman, serif' : settings.font === 'courier' ? 'Courier New, monospace' : 'Arial, sans-serif';
      document.getElementById('themeSelect').value = settings.theme;
      document.getElementById('fontSelect').value = settings.font;
    }

    // Toggle dark mode
    function toggleDarkMode() {
      settings.theme = settings.theme === 'dark' ? 'light' : 'dark';
      applySettings();
      setData(SETTINGS_KEY, settings);
    }

    // Change theme
    function changeTheme() {
      settings.theme = document.getElementById('themeSelect').value;
      applySettings();
    }

    // Change font
    function changeFont() {
      settings.font = document.getElementById('fontSelect').value;
      applySettings();
    }

    // Save settings
    function saveSettings() {
      setData(SETTINGS_KEY, settings);
      alert('Settings saved!');
    }

    // Show section
    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
      event.target.classList.add('active');
      document.getElementById('pageTitle').textContent = id.charAt(0).toUpperCase() + id.slice(1);

      if (id === 'dashboard') updateDashboard();
      if (id === 'warehouse') renderStockTable();
      if (id === 'reports') renderOutgoingReports();
      if (id === 'users') renderUsers();
    }

    // Login form
    document.getElementById('loginForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;
      const allUsers = getData(USERS_KEY);
      const user = allUsers.find(u => u.username === username && u.password === password);
      if (user) {
        user.lastLogin = new Date().toLocaleString();
        setData(USERS_KEY, allUsers);
        setSession(user);
        loginSuccess(user);
      } else {
        document.getElementById('loginError').classList.remove('hidden');
      }
    });

    // Login success
    function loginSuccess(user) {
      document.getElementById('loginModal').classList.add('hidden');
      document.getElementById('sidebar').classList.remove('hidden');
      document.getElementById('mainContent').classList.remove('hidden');
      document.getElementById('loggedInUser').textContent = user.username + ' (' + user.role + ')';
      applySettings();
      showSection('dashboard');
    }

    // Logout
    function logout() {
      clearSession();
      location.reload();
    }

    // Load on page load
    window.onload = () => {
      const session = getSession();
      if (session) {
        loginSuccess(session);
      } else {
        document.getElementById('loginModal').classList.remove('hidden');
      }
    };

    // Dashboard updates
    function updateDashboard() {
      const totalStock = Object.keys(stock).length;
      const totalOutgoing = outgoing.length;
      const lowStockAlerts = Object.values(stock).filter(qty => qty < 10).length;

      document.getElementById('totalStock').textContent = totalStock;
      document.getElementById('totalOutgoing').textContent = totalOutgoing;
      document.getElementById('lowStockAlerts').textContent = lowStockAlerts;

      const recentChangesBody = document.getElementById('recentChanges');
      const changeKeys = Object.keys(changes).slice(-5);
      recentChangesBody.innerHTML = '';
      changeKeys.forEach(key => {
        const change = changes[key];
        recentChangesBody.innerHTML += `<tr><td class="p-2">${change.item}</td><td class="p-2">${change.qty}</td><td class="p-2">${change.time}</td></tr>`;
      });

      const topOutgoing = {};
      outgoing.forEach(o => {
        topOutgoing[o.nama] = (topOutgoing[o.nama] || 0) + o.qty;
      });
      const sortedTop = Object.entries(topOutgoing).sort((a, b) => b[1] - a[1]).slice(0, 5);
      const topOutgoingBody = document.getElementById('topOutgoingItems');
      topOutgoingBody.innerHTML = '';
      sortedTop.forEach(([item, qty]) => {
        topOutgoingBody.innerHTML += `<tr><td class="p-2">${item}</td><td class="p-2">${qty}</td></tr>`;
      });
    }

    // Warehouse: Barang Masuk
    document.getElementById('formBarangMasuk').addEventListener('submit', function(e) {
      e.preventDefault();
      const item = document.getElementById('namaBarangMasuk').value;
      const qty = parseInt(document.getElementById('qtyBarangMasuk').value);
      stock[item] = (stock[item] || 0) + qty;
      setData(STOCK_KEY, stock);
      const time = new Date().toLocaleTimeString();
      changes[`add_${item}_${time}`] = { item, qty, time };
      setData(CHANGES_KEY, changes);
      updateDashboard();
      renderStockTable();
      document.getElementById('msgBarangMasuk').textContent = `${item} added!`;
      this.reset();
    });

    // Warehouse: Barang Keluar
    document.getElementById('formBarangKeluar').addEventListener('submit', function(e) {
      e.preventDefault();
      const item = document.getElementById('namaBarangKeluar').value;
      const qty = parseInt(document.getElementById('qtyBarangKeluar').value);
      if (!stock[item] || stock[item] < qty) {
        document.getElementById('msgBarangKeluar').textContent = 'Insufficient stock!';
        return;
      }
      stock[item] -= qty;
      if (stock[item] === 0) delete stock[item];
      setData(STOCK_KEY, stock);
      const time = new Date().toLocaleTimeString();
      changes[`remove_${item}_${time}`] = { item, qty: -qty, time };
      setData(CHANGES_KEY, changes);
      updateDashboard();
      renderStockTable();
      document.getElementById('msgBarangKeluar').textContent = `${item} removed!`;
      this.reset();
    });

    // Render stock table
    function renderStockTable() {
      const stockTable = document.getElementById('stockTable');
      stockTable.innerHTML = '';
      Object.entries(stock).forEach(([item, qty]) => {
        stockTable.innerHTML += `<tr><td class="p-2">${item}</td><td class="p-2">${qty}</td></tr>`;
      });
    }

    // Render outgoing reports
    function renderOutgoingReports() {
      const reportsBody = document.getElementById('outgoingReports');
      reportsBody.innerHTML = '';
      outgoing.forEach(o => {
        reportsBody.innerHTML += `<tr><td class="p-2">${o.nama}</td><td class="p-2">${o.qty}</td><td class="p-2">${o.toko}</td><td class="p-2">${o.tanggal}</td></tr>`;
      });
    }

    // Render users list
    function renderUsers() {
      const userTable = document.getElementById('userTableBody');
      const allUsers = getData(USERS_KEY);
      userTable.innerHTML = '';
      allUsers.forEach(u => {
        userTable.innerHTML += `<tr><td class="p-2">${u.username}</td><td class="p-2">${u.role}</td><td class="p-2">${u.lastLogin || 'Never'}</td></tr>`;
      });
    }

    // Toggle add user form
    function toggleAddUserForm() {
      const form = document.getElementById('addUserForm');
      form.classList.toggle('hidden');
      document.getElementById('addUserMsg').classList.add('hidden');
      document.getElementById('formAddUser').reset();
    }

    // Handle add user form submit
    document.getElementById('formAddUser').addEventListener('submit', function(e) {
      e.preventDefault();
      const username = document.getElementById('newUsername').value.trim();
      const password = document.getElementById('newPassword').value;
      const role = document.getElementById('newRole').value;

      if (!username || !password) {
        alert('Username dan password harus diisi.');
        return;
      }

      let allUsers = getData(USERS_KEY);
      if (allUsers.find(u => u.username.toLowerCase() === username.toLowerCase())) {
        alert('Username sudah ada, gunakan username lain.');
        return;
      }

      allUsers.push({ username, password, role, lastLogin: null });
      setData(USERS_KEY, allUsers);
      renderUsers();
      document.getElementById('addUserMsg').textContent = 'User berhasil ditambahkan!';
      document.getElementById('addUserMsg').classList.remove('hidden');
      this.reset();
    });

    // Initialize
    applySettings();
    lucide.createIcons();
  </script>

</body>
</html>
</content>
</create_file>

<attempt_completion>
Sistem WMS lengkap telah diperbarui dengan fitur tambah user di bagian Users. Sekarang administrator dapat menambah user baru dengan form yang muncul saat klik "Tambah User". Kode lengkap sudah digabungkan.
</attempt_completion>
