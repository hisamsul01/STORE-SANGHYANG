<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Warehouse Management System - Complete</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
  <script src="https://unpkg.com/html5-qrcode"></script>
  <style>
    .hidden { display: none; }
    body { transition: all 0.3s ease; }
    .dark-bg { background-color: #1f2937; color: #f9fafb; }
    .dark-section { background-color: #374151; color: #d1d5db; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen p-4">

  <!-- HEADER -->
  <header class="text-center py-6 bg-white shadow-md rounded-lg max-w-4xl mx-auto mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Warehouse Management System</h1>
  </header>

  <!-- NAV -->
  <nav class="flex flex-wrap justify-center gap-2 mb-6">
    <button onclick="showSection('barangMasuk')" class="nav-btn bg-blue-500 text-white py-2 px-4 rounded">Barang Masuk</button>
    <button onclick="showSection('barangKeluar')" class="nav-btn bg-green-500 text-white py-2 px-4 rounded">Barang Keluar</button>
    <button onclick="showSection('stock')" class="nav-btn bg-purple-500 text-white py-2 px-4 rounded">Stock</button>
    <button onclick="showSection('outgoing')" class="nav-btn bg-orange-500 text-white py-2 px-4 rounded">Outgoing to Store</button>
    <button onclick="showSection('pengaturan')" class="nav-btn bg-red-500 text-white py-2 px-4 rounded">Pengaturan</button>
  </nav>

  <!-- Barang Masuk -->
  <section id="barangMasuk" class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2">
      <i data-lucide="plus-circle" class="w-6 h-6 text-blue-500"></i> Barang Masuk
    </h2>
    <form id="formBarangMasuk" class="space-y-4">
      <input type="text" id="kodeMasuk" placeholder="Kode Barang" class="w-full border rounded px-3 py-2" />
      <input type="text" id="namaBarangMasuk" placeholder="Nama Barang" class="w-full border rounded px-3 py-2" required />
      <input type="number" id="qtyBarangMasuk" placeholder="Jumlah" class="w-full border rounded px-3 py-2" min="1" required />
      <button type="submit" class="bg-blue-600 text-white py-2 px-4 rounded">Tambah Barang Masuk</button>
    </form>
    <button onclick="startScan('Masuk')" class="mt-4 bg-green-600 text-white py-2 px-4 rounded">ðŸ“· Scan Barcode</button>
    <div id="msgBarangMasuk" class="text-green-500 mt-4"></div>
  </section>

  <!-- Barang Keluar -->
  <section id="barangKeluar" class="hidden max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2">
      <i data-lucide="minus-circle" class="w-6 h-6 text-red-500"></i> Barang Keluar
    </h2>
    <form id="formBarangKeluar" class="space-y-4">
      <input type="text" id="kodeKeluar" placeholder="Kode Barang" class="w-full border rounded px-3 py-2" />
      <input type="text" id="namaBarangKeluar" placeholder="Nama Barang" class="w-full border rounded px-3 py-2" required />
      <input type="number" id="qtyBarangKeluar" placeholder="Jumlah" class="w-full border rounded px-3 py-2" min="1" required />
      <button type="submit" class="bg-red-600 text-white py-2 px-4 rounded">Proses Barang Keluar</button>
    </form>
    <button onclick="startScan('Keluar')" class="mt-4 bg-green-600 text-white py-2 px-4 rounded">ðŸ“· Scan Barcode</button>
    <div id="msgBarangKeluar" class="text-green-500 mt-4"></div>
  </section>

  <!-- STOCK -->
  <section id="stock" class="hidden max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2">
      <i data-lucide="package" class="w-6 h-6 text-purple-500"></i> Stock Barang
    </h2>
    <table class="w-full mt-4 border-collapse border border-gray-300">
      <thead>
        <tr class="bg-blue-500 text-white">
          <th class="px-4 py-2 border">Nama Barang</th>
          <th class="px-4 py-2 border">Jumlah</th>
        </tr>
      </thead>
      <tbody id="tableStockBody"></tbody>
    </table>
  </section>

  <!-- Outgoing -->
  <section id="outgoing" class="hidden max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h2 class="text-2xl font-semibold mb-4 flex items-center gap-2">
      <i data-lucide="truck" class="w-6 h-6 text-orange-500"></i> Outgoing to Store
    </h2>
    <form id="formOutgoing" class="space-y-4">
      <input type="text" id="namaBarangOutgoing" placeholder="Nama Barang" class="w-full border rounded px-3 py-2" required />
      <input type="number" id="qtyBarangOutgoing" placeholder="Jumlah" class="w-full border rounded px-3 py-2" min="1" required />
      <select id="tokoTujuan" class="w-full border rounded px-3 py-2" required></select>
      <button type="submit" class="bg-orange-600 text-white py-2 px-4 rounded">Kirim ke Store</button>
    </form>
    <h3 class="text-xl font-medium mt-8 mb-4">Riwayat Outgoing</h3>
    <table class="w-full mt-4 border-collapse border border-gray-300">
      <thead>
        <tr class="bg-orange-500 text-white">
          <th class="px-4 py-2 border">Nama Barang</th>
          <th class="px-4 py-2 border">Jumlah</th>
          <th class="px-4 py-2 border">Toko Tujuan</th>
          <th class="px-4 py-2 border">Tanggal</th>
        </tr>
      </thead>
      <tbody id="tableOutgoingBody"></tbody>
    </table>
  </section>

  <!-- Scanner -->
  <div id="reader" class="hidden p-4"></div>

  <script>
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyGDvn3QkWuEulkzvNMxyMx10Af7CiPfYjWmA2Iha3AROV3VcnW2eTF5fdb5A2mkj8K/exec";
    let html5QrCode;

    // Show section
    function showSection(id) {
      document.querySelectorAll('section').forEach(s => s.classList.add('hidden'));
      document.getElementById(id).classList.remove('hidden');
      if (id === 'stock') renderStockTable();
      if (id === 'outgoing') renderOutgoingTable();
    }

    // Barang Masuk
    document.getElementById('formBarangMasuk').addEventListener('submit', e => {
      e.preventDefault();
      const kode = document.getElementById('kodeMasuk').value;
      const nama = document.getElementById('namaBarangMasuk').value;
      const qty = parseInt(document.getElementById('qtyBarangMasuk').value);
      processData("Masuk", kode, nama, qty);
      e.target.reset();
    });

    // Barang Keluar
    document.getElementById('formBarangKeluar').addEventListener('submit', e => {
      e.preventDefault();
      const kode = document.getElementById('kodeKeluar').value;
      const nama = document.getElementById('namaBarangKeluar').value;
      const qty = parseInt(document.getElementById('qtyBarangKeluar').value);
      processData("Keluar", kode, nama, qty);
      e.target.reset();
    });

    // Outgoing
    document.getElementById('formOutgoing').addEventListener('submit', e => {
      e.preventDefault();
      const nama = document.getElementById('namaBarangOutgoing').value;
      const qty = parseInt(document.getElementById('qtyBarangOutgoing').value);
      const toko = document.getElementById('tokoTujuan').value;
      if (!nama || qty < 1 || !toko) return;
      const outgoing = JSON.parse(localStorage.getItem('wms_outgoing')||'[]');
      outgoing.push({nama, qty, toko, tanggal:new Date().toLocaleString()});
      localStorage.setItem('wms_outgoing', JSON.stringify(outgoing));
      renderOutgoingTable();
      e.target.reset();
    });

    // Scan barcode
    function startScan(jenis) {
      const reader = document.getElementById("reader");
      reader.classList.remove("hidden");
      html5QrCode = new Html5Qrcode("reader");
      html5QrCode.start({facingMode:"environment"},{fps:10,qrbox:250},
        (decodedText) => {
          html5QrCode.stop().then(()=>reader.classList.add("hidden"));
          const nama = prompt("Nama Barang:", "");
          const jumlah = prompt("Jumlah:", "1");
          if (nama && jumlah) processData(jenis, decodedText, nama, jumlah);
        }
      );
    }

    // Kirim data
    function processData(jenis, kode, nama, qty) {
      if (!nama || qty<1) return;
      // Update stock local
      const stock = JSON.parse(localStorage.getItem('wms_stock')||'{}');
      if (jenis==="Masuk") {
        stock[nama]=(stock[nama]||0)+parseInt(qty);
      } else {
        if (!stock[nama]||stock[nama]<qty){alert("Stok tidak cukup!");return;}
        stock[nama]-=parseInt(qty);
        if (stock[nama]===0) delete stock[nama];
      }
      localStorage.setItem('wms_stock', JSON.stringify(stock));
      renderStockTable();
      // Kirim ke spreadsheet
      const payload = {jenis, kodeBarang:kode, namaBarang:nama, jumlah:qty};
      fetch(WEBAPP_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)})
      .then(r=>r.json()).then(d=>console.log("Sent:",d)).catch(e=>console.error(e));
      alert(`âœ… Data tersimpan: ${jenis} - ${nama}`);
    }

    // Render stock
    function renderStockTable() {
      const stock = JSON.parse(localStorage.getItem('wms_stock')||'{}');
      const tbody = document.getElementById('tableStockBody');
      tbody.innerHTML="";
      if(Object.keys(stock).length===0){tbody.innerHTML='<tr><td colspan="2">Tidak ada stok</td></tr>';return;}
      for (let item in stock){
        tbody.innerHTML+=`<tr><td class="border px-4 py-2">${item}</td><td class="border px-4 py-2">${stock[item]}</td></tr>`;
      }
    }

    // Render outgoing
    function renderOutgoingTable() {
      const outgoing = JSON.parse(localStorage.getItem('wms_outgoing')||'[]');
      const tbody = document.getElementById('tableOutgoingBody');
      tbody.innerHTML="";
      if(outgoing.length===0){tbody.innerHTML='<tr><td colspan="4">Belum ada pengiriman</td></tr>';return;}
      outgoing.forEach(o=>{
        tbody.innerHTML+=`<tr><td class="border px-4 py-2">${o.nama}</td><td class="border px-4 py-2">${o.qty}</td><td class="border px-4 py-2">${o.toko}</td><td class="border px-4 py-2">${o.tanggal}</td></tr>`;
      });
    }

    // Init
    showSection('barangMasuk');
    lucide.createIcons();
  </script>
</body>
</html>
